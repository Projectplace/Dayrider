<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- link rel="stylesheet" href="css/normalize.min.css" -->
        <!-- link rel="stylesheet" href="css/main.css" -->

    </head>
    <body>

      
        <h2>Dayrider</h2>
   
        <div style="float:left; margin:1em;">
        
          Headlights:
          <span id="headlights">
            <input type="radio" name="headlights" value="auto" checked>Auto</input>
            <input type="radio" name="headlights" value="kitmode">Kitmode</input>
            <input type="radio" name="headlights" value="carlight">Carlight</input>
            <input type="radio" name="headlights" value="off">Off</input>
          </span>
          
          <p>Control the dayrider with the arrow keys!</p>
          
          <p id="spinner" style="display:none">Please wait..</p>
          
	  <p id="msg"></p>
          <ul class="errors"></ul>
        </div>
        <div style="float:left; margin:1em;">
          Forward speed <input type="text" id="forward_speed" value="160" size="6"/> <br/>
          Backward speed <input type="text" id="backward_speed" value="140" size="6"/><br/>
          Turn speed <input type="text" id="turn_speed" value="80" size="6"/>
        </div>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.1.min.js"><\/script>')</script -->

        <script>

var ws = null;
var keypresses = [];
var ws_ready = function() {
    $(document).keydown(onkeydown);
    $(document).keyup(onkeyup);
    $("#headlights input[type='radio']").change(onheadlightchange);
    $("#forward_speed").change(onforwardspeedchange);
};
var ws_message = function(evt) {
  var msg = evt.data;
  if (msg == "HELLO") {
    ws_ready();
    $("#msg").html("Connected!");
  } else if (msg === "OK") {
    $("#spinner").hide();
  } else { 
    $("#msg").html(msg);
  }
};
var ws_connect = function() {
  $("#msg").html("Connecting...");
  if (!"WebSocket" in window) {
     alert("WebSocket NOT supported by your Browser!");
     return;
  }
  ws = new WebSocket("ws://localhost:8080/", "binary");
  ws.onopen = function() {
     ws.send("HELLO");
  };
  ws.onmessage = ws_message;
};
var ws_onclode = function() {
  $("#msg").html("Disconnected");
  sleep(3);
  ws_connect();
};
var onkeydown = function(e) {
   if (-1 == keypresses.indexOf(e.keyCode)) {
      keypresses.push(e.keyCode);
      return onkey("down", e);
   }
};
var onkeyup = function(e) {
   keypresses.splice(keypresses.indexOf(e.keyCode), 1);
   return onkey("up", e);
};
var onkey = function(updown, e) {
    var dir, spd;
    e = e || window.event;
    if (e.keyCode == 38) {
       dir = 'forward';
    } else if (e.keyCode == 40){
       dir ='backward'; 
       spd = $('#backward_speed').val();
    } else if (e.keyCode == 37){
       dir = 'left';
    } else if (e.keyCode == 39){
       dir = 'right';
    } else {
       return;
    }
    $("#spinner").show();
    ws.send(updown + "/" + dir + "\n");
    $(".errors").append("<li>"+updown + "/" + dir + "</li>");
};
var onheadlightchange = function(e) {
    var mode = $("#headlights input[type='radio']:checked").val();
    ws.send("headlightmode/" + mode + "\n");
};
var onturnspeedchange = function(e) {
    var spd = $('#turnward_speed').val();
    ws.send("turnspeed/" + spd + "\n");
};
var onforwardspeedchange = function(e) {
    var spd = $('#forward_speed').val();
    ws.send("forwardspeed/" + spd + "\n");
};
var onbackwardspeedchange = function(e) {
    var spd = $('#backward_speed').val();
    ws.send("backwardspeed/" + spd + "\n");
};
$(document).ready(function() {
    ws_connect();
    ws_ready();
    
});
</script>
    </body>
</html>
