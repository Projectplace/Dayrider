<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- link rel="stylesheet" href="css/normalize.min.css" -->
        <!-- link rel="stylesheet" href="css/main.css" -->

    </head>
    <body>

        <h2>Dayrider</h2>
   
        Headlights:
        <span id="headlights">
        <input type="radio" name="headlights" value="auto" checked>Auto</input>
        <input type="radio" name="headlights" value="kitmode">Kitmode</input>
        <input type="radio" name="headlights" value="carlight">Carlight</input>
        <input type="radio" name="headlights" value="off">Off</input>
        </span>

        <p>Control the dayrider with the arrow keys!</p>

        <p id="spinner" style="display:none">Please wait..</p>

        <ul class="errors"></ul>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.1.min.js"><\/script>')</script -->

        <script>
var onkeydown = function(e) {
    e = e || window.event;
    if (e.keyCode == 38) {
       dir = 'forward';
    } else if (e.keyCode == 40){
       dir ='backward';
    } else if (e.keyCode == 37){
       dir = 'left';
    } else if (e.keyCode == 39){
       dir = 'right';
    } else {
       return;
    }

    $('#spinner').show();
    $(document).unbind('keydown');
    xhr = jQuery.get('/mailbox/' + dir);
    xhr.always(function() {
         $('#spinner').hide();
         $(document).keydown(onkeydown);
    });
    xhr.fail(function() {
         $('.errors').append("<li>Error sending movement "+dir+"</li>");
    });

};

var onheadlightchange = function(e) {
    var mode = $("#headlights input[type='radio']:checked").val();
    $('#spinner').show();
    xhr = jQuery.get('/mailbox/headlight/' + mode);
    xhr.always(function() {
         $('#spinner').hide();
    });
    xhr.fail(function() {
         $('.errors').append("<li>Error sending headlight mode "+mode+"</li>");
    });
};

$(document).ready(function() {
    $(document).keydown(onkeydown);
    $("#headlights input[type='radio']").change(onheadlightchange);
});
</script>
    </body>
</html>
